# Cloudflare Tunnel Environment Configuration for SSO POC
# Copy this file to .env.cloudflare and customize the values
# DO NOT commit .env.cloudflare to version control!

#################################################################################
# DOMAIN CONFIGURATION
#################################################################################

# Primary domain for the SSO POC
DOMAIN=hi-dil.com

# Application URLs (using Cloudflare Tunnel)
CENTRAL_SSO_URL=https://sso.poc.hi-dil.com
TENANT1_URL=https://tenant-one.poc.hi-dil.com
TENANT2_URL=https://tenant-two.poc.hi-dil.com

# Internal API endpoints (used for service-to-service communication)
CENTRAL_SSO_API_INTERNAL=http://central-sso:8000/api
TENANT1_API_INTERNAL=http://tenant1-app:8000/api
TENANT2_API_INTERNAL=http://tenant2-app:8000/api

#################################################################################
# CLOUDFLARE TUNNEL CONFIGURATION
#################################################################################

# Tunnel name and ID (generated during setup)
TUNNEL_NAME=sso-poc-tunnel
TUNNEL_ID=your-tunnel-id-here

# Cloudflare account information
CLOUDFLARE_ACCOUNT_ID=your-cloudflare-account-id
CLOUDFLARE_ZONE_ID=your-zone-id-for-hi-dil-com

#################################################################################
# APPLICATION ENVIRONMENT
#################################################################################

# Environment settings
APP_ENV=production
APP_DEBUG=false
LOG_LEVEL=warning
LOG_STDERR_FORMATTER=Monolog\\Formatter\\JsonFormatter

# Asset configuration
ASSET_URL=https://sso.poc.hi-dil.com

#################################################################################
# SESSION CONFIGURATION
#################################################################################

# Session domain (allows session sharing across subdomains)
SESSION_DOMAIN=.poc.hi-dil.com
SESSION_DRIVER=redis
SESSION_LIFETIME=120
SESSION_SECURE_COOKIE=true
SESSION_SAME_SITE=lax
SESSION_ENCRYPT=true

#################################################################################
# SECURITY CONFIGURATION
#################################################################################

# Security headers
SECURE_HEADERS=true
HSTS_MAX_AGE=31536000

# CORS configuration for cross-domain requests
CORS_ALLOWED_ORIGINS=https://sso.poc.hi-dil.com,https://tenant-one.poc.hi-dil.com,https://tenant-two.poc.hi-dil.com
CORS_ALLOWED_HEADERS=accept,authorization,content-type,x-xsrf-token,x-csrf-token,x-requested-with,x-api-key,x-signature,x-timestamp
CORS_EXPOSED_HEADERS=x-request-id,x-rate-limit-remaining
CORS_MAX_AGE=86400
CORS_SUPPORTS_CREDENTIALS=true

# Sanctum configuration for API authentication
SANCTUM_STATEFUL_DOMAINS=sso.poc.hi-dil.com,tenant-one.poc.hi-dil.com,tenant-two.poc.hi-dil.com

# Trusted proxies (Cloudflare IP ranges)
TRUSTED_PROXIES=173.245.48.0/20,103.21.244.0/22,103.22.200.0/22,103.31.4.0/22,141.101.64.0/18,108.162.192.0/18,190.93.240.0/20,188.114.96.0/20,197.234.240.0/22,198.41.128.0/17,162.158.0.0/15,104.16.0.0/13,104.24.0.0/14,172.64.0.0/13,131.0.72.0/22

#################################################################################
# DATABASE CONFIGURATION
#################################################################################

# Database settings
DB_CONNECTION=mysql
DB_HOST=mariadb
DB_PORT=3306
DB_DATABASE=sso_main
DB_USERNAME=sso_user
DB_PASSWORD=your-secure-database-password

# Database optimization settings
DB_CHARSET=utf8mb4
DB_COLLATION=utf8mb4_unicode_ci

#################################################################################
# REDIS CONFIGURATION
#################################################################################

# Redis for caching and sessions
REDIS_HOST=redis
REDIS_PASSWORD=secure_redis_password_change_me
REDIS_PORT=6379
REDIS_DB=0

# Cache configuration
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
BROADCAST_DRIVER=redis

#################################################################################
# JWT CONFIGURATION
#################################################################################

# JWT settings for token-based authentication
JWT_SECRET=your-jwt-secret-key-minimum-32-characters-long
JWT_TTL=3600
JWT_REFRESH_TTL=20160
JWT_ALGO=HS256
JWT_REQUIRED_CLAIMS=iss,iat,exp,nbf,sub,jti
JWT_PERSISTENT_CLAIMS=

#################################################################################
# TENANT-SPECIFIC CONFIGURATION
#################################################################################

# Tenant API keys for secure communication
TENANT1_API_KEY=tenant1_your-32-character-api-key-here
TENANT2_API_KEY=tenant2_your-32-character-api-key-here

# HMAC secrets for request signing
TENANT1_HMAC_SECRET=your-64-character-hmac-secret-for-tenant1-signing
TENANT2_HMAC_SECRET=your-64-character-hmac-secret-for-tenant2-signing

# Tenant slugs
TENANT1_SLUG=tenant1
TENANT2_SLUG=tenant2

#################################################################################
# EMAIL CONFIGURATION
#################################################################################

# Mail settings
MAIL_MAILER=smtp
MAIL_HOST=smtp.your-email-provider.com
MAIL_PORT=587
MAIL_USERNAME=noreply@hi-dil.com
MAIL_PASSWORD=your-email-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@hi-dil.com
MAIL_FROM_NAME="SSO POC System"

#################################################################################
# FILE STORAGE CONFIGURATION
#################################################################################

# File storage (consider using S3 for production)
FILESYSTEM_DRIVER=local
# For S3 (uncomment and configure):
# FILESYSTEM_DRIVER=s3
# AWS_ACCESS_KEY_ID=your-aws-access-key
# AWS_SECRET_ACCESS_KEY=your-aws-secret-key
# AWS_DEFAULT_REGION=us-east-1
# AWS_BUCKET=your-s3-bucket-name
# AWS_USE_PATH_STYLE_ENDPOINT=false

#################################################################################
# MONITORING AND LOGGING
#################################################################################

# Application monitoring
TELESCOPE_ENABLED=false

# Error tracking (optional)
# SENTRY_LARAVEL_DSN=your-sentry-dsn

# Log channels
LOG_CHANNEL=stack
LOG_STACK=single,stderr

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_DRIVER=database
AUDIT_LOG_RETENTION_DAYS=90

#################################################################################
# BACKUP CONFIGURATION
#################################################################################

# Database backup settings
BACKUP_ENABLED=true
BACKUP_RETENTION_DAYS=30
MYSQL_BACKUP_PATH=/backups/mysql
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM

# Backup destinations
# S3_BACKUP_BUCKET=your-backup-bucket
# BACKUP_ENCRYPTION_KEY=your-backup-encryption-key

#################################################################################
# PERFORMANCE OPTIMIZATION
#################################################################################

# Cache optimization
VIEW_CACHE_ENABLED=true
ROUTE_CACHE_ENABLED=true
CONFIG_CACHE_ENABLED=true

# Database optimization
DB_CONNECTION_POOL_SIZE=10
DB_QUERY_CACHE_ENABLED=true

# Session optimization
SESSION_CONNECTION=redis

#################################################################################
# RATE LIMITING
#################################################################################

# API rate limiting
RATE_LIMIT_API=100,1
RATE_LIMIT_AUTH=5,1
RATE_LIMIT_AUDIT=100,1

# Per-IP rate limiting
RATE_LIMIT_GLOBAL=1000,60

#################################################################################
# DEVELOPMENT AND DEBUGGING
#################################################################################

# Development tools (disable in production)
DEBUGBAR_ENABLED=false
QUERY_LOG_ENABLED=false

# Feature flags
FEATURE_API_V2_ENABLED=false
FEATURE_ADVANCED_AUDIT_ENABLED=true
FEATURE_SOCIAL_LOGIN_ENABLED=false

#################################################################################
# CLOUDFLARE-SPECIFIC SETTINGS
#################################################################################

# Cloudflare features
CF_CACHE_ENABLED=true
CF_MINIFY_ENABLED=true
CF_ALWAYS_ONLINE=true
CF_BROWSER_CACHE_TTL=14400

# Cloudflare security
CF_SECURITY_LEVEL=medium
CF_CHALLENGE_PASSAGE=30

#################################################################################
# HEALTH CHECK CONFIGURATION
#################################################################################

# Health check endpoints
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_CACHE_TTL=60
HEALTH_CHECK_SECRET=your-health-check-secret

# Service dependencies for health checks
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_STORAGE=true
HEALTH_CHECK_EXTERNAL_APIS=false

#################################################################################
# CUSTOM APPLICATION SETTINGS
#################################################################################

# SSO-specific settings
SSO_TOKEN_LIFETIME=3600
SSO_REFRESH_TOKEN_LIFETIME=604800
SSO_REMEMBER_TOKEN_LIFETIME=2592000

# Multi-tenant settings
TENANT_ISOLATION_ENABLED=true
TENANT_SUBDOMAIN_ROUTING=true

# User management
USER_REGISTRATION_ENABLED=false
USER_EMAIL_VERIFICATION_REQUIRED=true
USER_PASSWORD_RESET_ENABLED=true

# API versioning
API_VERSION=v1
API_PREFIX=api
API_MIDDLEWARE=api,auth:api,throttle:api

#################################################################################
# SECURITY NOTES
#################################################################################

# IMPORTANT SECURITY NOTES:
# 1. Change all default passwords and secrets
# 2. Use strong, unique values for JWT_SECRET and HMAC secrets
# 3. Set appropriate file permissions (600) for this file
# 4. Never commit this file to version control
# 5. Use environment-specific values for each deployment
# 6. Regularly rotate API keys and secrets
# 7. Monitor for any unauthorized access attempts
# 8. Keep Cloudflare security features enabled
# 9. Regularly update SSL/TLS certificates (automatic with Cloudflare)
# 10. Review and audit access logs regularly